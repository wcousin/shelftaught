// PostgreSQL schema for production and Railway deployment

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  firstName String
  lastName  String
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  savedCurricula SavedCurriculum[]

  @@map("users")
}

model Subject {
  id          String @id @default(cuid())
  name        String @unique
  description String
  
  curriculumSubjects CurriculumSubject[]

  @@map("subjects")
}

model GradeLevel {
  id       String @id @default(cuid())
  name     String @unique
  ageRange String
  minAge   Int
  maxAge   Int

  curricula Curriculum[]

  @@map("grade_levels")
}

model Curriculum {
  id          String   @id @default(cuid())
  name        String
  publisher   String
  description String
  imageUrl    String?
  slug        String?  @unique // SEO-friendly URL slug (optional during migration)
  
  // Target Age/Grade
  gradeLevelId String
  gradeLevel   GradeLevel @relation(fields: [gradeLevelId], references: [id])
  targetAgeGradeRating Int @default(0) // 1-5 scale
  
  // Teaching Approach
  teachingApproachStyle String
  teachingApproachDescription String
  teachingApproachRating Int @default(0)
  
  // Subjects Covered
  subjectComprehensiveness Int @default(0) // 1-5 scale
  subjectsCoveredRating Int @default(0)
  
  // Materials Included
  materialsComponents String[] // PostgreSQL array
  materialsCompleteness Int @default(0) // 1-5 scale
  materialsIncludedRating Int @default(0)
  
  // Instruction Style
  instructionStyleType String
  instructionSupportLevel Int @default(0) // 1-5 scale
  instructionStyleRating Int @default(0)
  
  // Time Commitment
  timeCommitmentDailyMinutes Int @default(0)
  timeCommitmentWeeklyHours Float @default(0)
  timeCommitmentFlexibility Int @default(0) // 1-5 scale
  timeCommitmentRating Int @default(0)
  
  // Cost
  costPriceRange String // "$", "$$", "$$$", "$$$$"
  costValue Int @default(0) // 1-5 scale
  costRating Int @default(0)
  
  // Additional Information
  strengths String[] // PostgreSQL array
  weaknesses String[] // PostgreSQL array
  bestFor String[] // PostgreSQL array
  fullReview String? // Optional full review text
  
  // Availability
  availabilityInPrint Boolean @default(true)
  availabilityDigital Boolean @default(false)
  availabilityUsedMarket Boolean @default(false)
  availabilityRating Int @default(0)
  
  // Overall metrics
  overallRating Float @default(0) // Calculated average
  reviewCount Int @default(1)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  curriculumSubjects CurriculumSubject[]
  savedBy SavedCurriculum[]

  @@map("curricula")
}

model CurriculumSubject {
  id           String @id @default(cuid())
  curriculumId String
  subjectId    String

  curriculum Curriculum @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  subject    Subject    @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([curriculumId, subjectId])
  @@map("curriculum_subjects")
}

model SavedCurriculum {
  id           String  @id @default(cuid())
  userId       String
  curriculumId String
  personalNotes String?
  savedAt      DateTime @default(now())

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  curriculum Curriculum @relation(fields: [curriculumId], references: [id], onDelete: Cascade)

  @@unique([userId, curriculumId])
  @@map("saved_curricula")
}